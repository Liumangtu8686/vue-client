import{E as e,O as t,B as n}from"../bson/bson.08937912.js";var r,o,i;(i=o||(o={})).DocIDError="文档ID不合法",i.CollNameError="集合名称不合法",i.OpStrError="操作符不合法",i.DirectionError="排序字符不合法",i.IntegerError="must be integer",i.QueryParamTypeError="查询参数必须为对象",i.QueryParamValueError="查询参数对象值不能均为undefined";var u,a,s,c,f="Number",l="Object",p="Array",d="GeoPoint",h="GeoLineString",y="GeoPolygon",w="GeoMultiPoint",m="GeoMultiLineString",g="GeoMultiPolygon",v="Date",b="ServerDate",_="BsonDate",O="ObjectId",E="Binary",T=["desc","asc"],N=["<","<=","==",">=",">"];(a=u||(u={})).lt="<",a.gt=">",a.lte="<=",a.gte=">=",a.eq="==",(r={})[u.eq]="$eq",r[u.lt]="$lt",r[u.lte]="$lte",r[u.gt]="$gt",r[u.gte]="$gte",(c=s||(s={})).add="database.addDocument",c.query="database.queryDocument",c.update="database.updateDocument",c.count="database.countDocument",c.remove="database.deleteDocument",c.aggregate="database.aggregateDocuments";var S,P=globalThis&&globalThis.__extends||(S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),I=[],q={},A=function(e){function t(t,n){if(n!==q)throw new TypeError("InternalSymbol cannot be constructed with new operator");return e.call(this,t)||this}return P(t,e),t.for=function(e){for(var n=0,r=I.length;n<r;n++)if(I[n].target===e)return I[n].instance;var o=new t(e,q);return I.push({target:e,instance:o}),o},t}((function(e){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:e}})})),j=A.for("UNSET_FIELD_NAME"),L=A.for("UPDATE_COMMAND"),M=A.for("QUERY_COMMAND"),k=A.for("LOGIC_COMMAND"),D=A.for("GEO_POINT"),C=A.for("SYMBOL_GEO_LINE_STRING"),$=A.for("SYMBOL_GEO_POLYGON"),x=A.for("SYMBOL_GEO_MULTI_POINT"),F=A.for("SYMBOL_GEO_MULTI_LINE_STRING"),R=A.for("SYMBOL_GEO_MULTI_POLYGON"),G=A.for("SERVER_DATE"),U=A.for("REGEXP"),Q=function(){function e(e){var t=(void 0===e?{}:e).offset,n=void 0===t?0:t;this.offset=n}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return G},enumerable:!0,configurable:!0}),e.prototype.parse=function(){return{$date:{offset:this.offset}}},e}();function H(e){return new Q(e)}var J=function(){function r(){}return r.formatResDocumentData=function(e){return e.map((function(e){return r.formatField(e)}))},r.formatField=function(t){var n=Object.keys(t),o={};return Array.isArray(t)&&(o=[]),n.forEach((function(n){var i,u=t[n];switch(r.whichType(u)){case d:i=new ne(u.coordinates[0],u.coordinates[1]);break;case h:i=new re(u.coordinates.map((function(e){return new ne(e[0],e[1])})));break;case y:i=new oe(u.coordinates.map((function(e){return new re(e.map((function(e){var t=e[0],n=e[1];return new ne(t,n)})))})));break;case w:i=new ie(u.coordinates.map((function(e){return new ne(e[0],e[1])})));break;case m:i=new ue(u.coordinates.map((function(e){return new re(e.map((function(e){var t=e[0],n=e[1];return new ne(t,n)})))})));break;case g:i=new ae(u.coordinates.map((function(e){return new oe(e.map((function(e){return new re(e.map((function(e){var t=e[0],n=e[1];return new ne(t,n)})))})))})));break;case v:i=new Date(1e3*u.$timestamp);break;case l:case p:i=r.formatField(u);break;case b:i=new Date(u.$date);break;case O:case E:i=e.deserialize(u);break;default:i=u}Array.isArray(o)?o.push(i):o[n]=i})),o},r.whichType=function(e){var r=Object.prototype.toString.call(e).slice(8,-1);if(r===v)return _;if(r===l){if(e instanceof ne)return d;if(e instanceof Date)return v;if(e instanceof Q)return b;if(e instanceof t)return O;if(e instanceof n)return E;e.$timestamp?r=v:e.$date?r=b:ne.validate(e)?r=d:re.validate(e)?r=h:oe.validate(e)?r=y:ie.validate(e)?r=w:ue.validate(e)?r=m:ae.validate(e)?r=g:e.$oid?r=O:e.$binary&&(r=E)}return r},r}(),B=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},W=function(e){return"object"===B(e)},z=function(e){return"number"===B(e)},Y=function(e){return Array.isArray(e)},K=function(e){return"date"===B(e)},V=function(e){return"regexp"===B(e)},X=function(e){return e&&e._internalType instanceof A},Z=function(e){return"ObjectID"===(null==e?void 0:e._bsontype)},ee=function(e){return"Binary"===(null==e?void 0:e._bsontype)},te=function(){function e(){}return e.isValidAggregation=function(e){if(1!==Object.keys(e).length)throw new Error("aggregation stage must have one key");return!0},e.isGeopoint=function(e,t){if(J.whichType(t)!==f)throw new Error("Geo Point must be number type");var n=Math.abs(t);if("latitude"===e&&n>90)throw new Error("latitude should be a number ranges from -90 to 90");if("longitude"===e&&n>180)throw new Error("longitude should be a number ranges from -180 to 180");return!0},e.isInteger=function(e,t){if(!Number.isInteger(t))throw new Error(e+o.IntegerError);return!0},e.isProjection=function(e,t){if("object"!==B(t))throw new Error(e+" projection must be an object");for(var n in t){var r=t[n];if("number"===B(r)){if(0!==r&&1!==r)throw new Error("if the value in projection is of number, it must be 0 or 1")}else if("object"!==B(r))throw new Error("invalid projection")}return!0},e.isOrder=function(e,t){if("object"!==B(t))throw new Error(e+" order must be an object");for(var n in t){var r=t[n];if(1!==r&&-1!==r)throw new Error("order value must be 1 or -1")}return!0},e.isFieldOrder=function(e){if(-1===T.indexOf(e))throw new Error(o.DirectionError);return!0},e.isFieldPath=function(e){if(!/^[a-zA-Z0-9-_\.]/.test(e))throw new Error;return!0},e.isOperator=function(e){if(-1===N.indexOf(e))throw new Error(o.OpStrError);return!0},e.isCollName=function(e){if(!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(e))throw new Error(o.CollNameError);return!0},e}(),ne=function(){function e(e,t){te.isGeopoint("longitude",e),te.isGeopoint("latitude",t),this.longitude=e,this.latitude=t}return e.prototype.parse=function(e){var t;return(t={})[e]={type:"Point",coordinates:[this.longitude,this.latitude]},t},e.prototype.toJSON=function(){return{type:"Point",coordinates:[this.longitude,this.latitude]}},e.prototype.toReadableString=function(){return"["+this.longitude+","+this.latitude+"]"},e.validate=function(e){return"Point"===e.type&&Y(e.coordinates)&&te.isGeopoint("longitude",e.coordinates[0])&&te.isGeopoint("latitude",e.coordinates[1])},Object.defineProperty(e.prototype,"_internalType",{get:function(){return D},enumerable:!0,configurable:!0}),e}(),re=function(){function e(e){if(!Y(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(e.length<2)throw new Error('"points" must contain 2 points at least');e.forEach((function(e){if(!(e instanceof ne))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e+"[]")})),this.points=e}return e.prototype.parse=function(e){var t;return(t={})[e]={type:"LineString",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))},t},e.prototype.toJSON=function(){return{type:"LineString",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))}},e.validate=function(e){if("LineString"!==e.type||!Y(e.coordinates))return!1;for(var t=0,n=e.coordinates;t<n.length;t++){var r=n[t];if(!z(r[0])||!z(r[1]))return!1}return!0},e.isClosed=function(e){var t=e.points[0],n=e.points[e.points.length-1];if(t.latitude===n.latitude&&t.longitude===n.longitude)return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return C},enumerable:!0,configurable:!0}),e}(),oe=function(){function e(e){if(!Y(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(0===e.length)throw new Error("Polygon must contain 1 linestring at least");e.forEach((function(e){if(!(e instanceof re))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e+"[]");if(!re.isClosed(e))throw new Error("LineString "+e.points.map((function(e){return e.toReadableString()}))+" is not a closed cycle")})),this.lines=e}return e.prototype.parse=function(e){var t;return(t={})[e]={type:"Polygon",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))},t},e.prototype.toJSON=function(){return{type:"Polygon",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}},e.validate=function(e){if("Polygon"!==e.type||!Y(e.coordinates))return!1;for(var t=0,n=e.coordinates;t<n.length;t++){var r=n[t];if(!this.isCloseLineString(r))return!1;for(var o=0,i=r;o<i.length;o++){var u=i[o];if(!z(u[0])||!z(u[1]))return!1}}return!0},e.isCloseLineString=function(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]},Object.defineProperty(e.prototype,"_internalType",{get:function(){return R},enumerable:!0,configurable:!0}),e}(),ie=function(){function e(e){if(!Y(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(0===e.length)throw new Error('"points" must contain 1 point at least');e.forEach((function(e){if(!(e instanceof ne))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e+"[]")})),this.points=e}return e.prototype.parse=function(e){var t;return(t={})[e]={type:"MultiPoint",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))},t},e.prototype.toJSON=function(){return{type:"MultiPoint",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))}},e.validate=function(e){if("MultiPoint"!==e.type||!Y(e.coordinates))return!1;for(var t=0,n=e.coordinates;t<n.length;t++){var r=n[t];if(!z(r[0])||!z(r[1]))return!1}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return x},enumerable:!0,configurable:!0}),e}(),ue=function(){function e(e){if(!Y(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(0===e.length)throw new Error("Polygon must contain 1 linestring at least");e.forEach((function(e){if(!(e instanceof re))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e+"[]")})),this.lines=e}return e.prototype.parse=function(e){var t;return(t={})[e]={type:"MultiLineString",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))},t},e.prototype.toJSON=function(){return{type:"MultiLineString",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}},e.validate=function(e){if("MultiLineString"!==e.type||!Y(e.coordinates))return!1;for(var t=0,n=e.coordinates;t<n.length;t++)for(var r=0,o=n[t];r<o.length;r++){var i=o[r];if(!z(i[0])||!z(i[1]))return!1}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return F},enumerable:!0,configurable:!0}),e}(),ae=function(){function e(e){if(!Y(e))throw new TypeError('"polygons" must be of type Polygon[]. Received type '+typeof e);if(0===e.length)throw new Error("MultiPolygon must contain 1 polygon at least");for(var t=0,n=e;t<n.length;t++){var r=n[t];if(!(r instanceof oe))throw new TypeError('"polygon" must be of type Polygon[]. Received type '+typeof r+"[]")}this.polygons=e}return e.prototype.parse=function(e){var t;return(t={})[e]={type:"MultiPolygon",coordinates:this.polygons.map((function(e){return e.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}))},t},e.prototype.toJSON=function(){return{type:"MultiPolygon",coordinates:this.polygons.map((function(e){return e.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}))}},e.validate=function(e){if("MultiPolygon"!==e.type||!Y(e.coordinates))return!1;for(var t=0,n=e.coordinates;t<n.length;t++)for(var r=0,o=n[t];r<o.length;r++)for(var i=0,u=o[r];i<u.length;i++){var a=u[i];if(!z(a[0])||!z(a[1]))return!1}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return $},enumerable:!0,configurable:!0}),e}();const se=Object.freeze(Object.defineProperty({__proto__:null,LineString:re,MultiLineString:ue,MultiPoint:ie,MultiPolygon:ae,Point:ne,Polygon:oe},Symbol.toStringTag,{value:"Module"}));var ce,fe,le=globalThis&&globalThis.__assign||function(){return le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},le.apply(this,arguments)},pe=globalThis&&globalThis.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],u=0,a=i.length;u<a;u++,o++)r[o]=i[u];return r};function de(e){return he(e,[e])}function he(t,n){if(!X(t)){if(K(t)||V(t)||Z(t)||ee(t))return e.serialize(t);if(Y(t))return t.map((function(e){if(n.indexOf(e)>-1)throw new Error("Cannot convert circular structure to JSON");return he(e,pe(n,[e]))}));if(W(t)){var r=le({},t);for(var o in r){if(n.indexOf(r[o])>-1)throw new Error("Cannot convert circular structure to JSON");r[o]=he(r[o],pe(n,[r[o]]))}return r}return t}switch(t._internalType){case D:return t.toJSON();case G:case U:return t.parse();default:return t.toJSON?t.toJSON():t}}(fe=ce||(ce={})).SET="set",fe.REMOVE="remove",fe.INC="inc",fe.MUL="mul",fe.PUSH="push",fe.PULL="pull",fe.PULL_ALL="pullAll",fe.POP="pop",fe.SHIFT="shift",fe.UNSHIFT="unshift",fe.ADD_TO_SET="addToSet",fe.BIT="bit",fe.RENAME="rename",fe.MAX="max",fe.MIN="min";var ye,we,me=function(){function e(e,t,n){this._internalType=L,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=n||j}return e.prototype._setFieldName=function(t){return new e(this.operator,this.operands,t)},e}();function ge(e){return e&&e instanceof me&&e._internalType===L}(we=ye||(ye={})).AND="and",we.OR="or",we.NOT="not",we.NOR="nor";var ve=function(){function e(e,t,n){if(this._internalType=k,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=n||j,this.fieldName!==j)if(Array.isArray(t)){t=t.slice(),this.operands=t;for(var r=0,o=t.length;r<o;r++){(be(i=t[r])||Ne(i))&&(t[r]=i._setFieldName(this.fieldName))}}else{var i;(be(i=t)||Ne(i))&&(t=i._setFieldName(this.fieldName))}}return e.prototype._setFieldName=function(t){var n=this.operands.map((function(n){return n instanceof e?n._setFieldName(t):n}));return new e(this.operator,n,t)},e.prototype.and=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return t.unshift(this),new e(ye.AND,t,this.fieldName)},e.prototype.or=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return t.unshift(this),new e(ye.OR,t,this.fieldName)},e}();function be(e){return e&&e instanceof ve&&e._internalType===k}var _e,Oe,Ee=globalThis&&globalThis.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();(Oe=_e||(_e={})).EQ="eq",Oe.NEQ="neq",Oe.GT="gt",Oe.GTE="gte",Oe.LT="lt",Oe.LTE="lte",Oe.IN="in",Oe.NIN="nin",Oe.ALL="all",Oe.ELEM_MATCH="elemMatch",Oe.EXISTS="exists",Oe.SIZE="size",Oe.MOD="mod",Oe.GEO_NEAR="geoNear",Oe.GEO_WITHIN="geoWithin",Oe.GEO_INTERSECTS="geoIntersects",Oe.LIKE="like";var Te=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.operator=t,o._internalType=M,o}return Ee(t,e),t.prototype.toJSON=function(){var e,t;switch(this.operator){case _e.IN:case _e.NIN:return(e={})["$"+this.operator]=this.operands,e;default:return(t={})["$"+this.operator]=this.operands[0],t}},t.prototype._setFieldName=function(e){return new t(this.operator,this.operands,e)},t.prototype.eq=function(e){var n=new t(_e.EQ,[e],this.fieldName);return this.and(n)},t.prototype.neq=function(e){var n=new t(_e.NEQ,[e],this.fieldName);return this.and(n)},t.prototype.gt=function(e){var n=new t(_e.GT,[e],this.fieldName);return this.and(n)},t.prototype.gte=function(e){var n=new t(_e.GTE,[e],this.fieldName);return this.and(n)},t.prototype.lt=function(e){var n=new t(_e.LT,[e],this.fieldName);return this.and(n)},t.prototype.lte=function(e){var n=new t(_e.LTE,[e],this.fieldName);return this.and(n)},t.prototype.in=function(e){var n=new t(_e.IN,e,this.fieldName);return this.and(n)},t.prototype.nin=function(e){var n=new t(_e.NIN,e,this.fieldName);return this.and(n)},t.prototype.geoNear=function(e){if(!(e.geometry instanceof ne))throw new TypeError('"geometry" must be of type Point. Received type '+typeof e.geometry);if(void 0!==e.maxDistance&&!z(e.maxDistance))throw new TypeError('"maxDistance" must be of type Number. Received type '+typeof e.maxDistance);if(void 0!==e.minDistance&&!z(e.minDistance))throw new TypeError('"minDistance" must be of type Number. Received type '+typeof e.minDistance);var n=new t(_e.GEO_NEAR,[e],this.fieldName);return this.and(n)},t.prototype.geoWithin=function(e){if(!(e.geometry instanceof ae||e.geometry instanceof oe))throw new TypeError('"geometry" must be of type Polygon or MultiPolygon. Received type '+typeof e.geometry);var n=new t(_e.GEO_WITHIN,[e],this.fieldName);return this.and(n)},t.prototype.geoIntersects=function(e){if(!(e.geometry instanceof ne||e.geometry instanceof re||e.geometry instanceof oe||e.geometry instanceof ie||e.geometry instanceof ue||e.geometry instanceof ae))throw new TypeError('"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type '+typeof e.geometry);var n=new t(_e.GEO_INTERSECTS,[e],this.fieldName);return this.and(n)},t}(ve);function Ne(e){return e&&e instanceof Te&&e._internalType===M}function Se(e){return Ne(e)}var Pe={};for(var Ie in _e)Pe[Ie]="$"+Ie;for(var Ie in ye)Pe[Ie]="$"+Ie;for(var Ie in ce)Pe[Ie]="$"+Ie;function qe(e){return Pe[e]||"$"+e}Pe[_e.NEQ]="$ne",Pe[ce.REMOVE]="$unset",Pe[ce.SHIFT]="$pop",Pe[ce.UNSHIFT]="$push";var Ae=globalThis&&globalThis.__assign||function(){return Ae=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ae.apply(this,arguments)},je=globalThis&&globalThis.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],u=0,a=i.length;u<a;u++,o++)r[o]=i[u];return r};function Le(e,t,n,r){var o=Ae({},e);for(var i in e)if(!/^\$/.test(i)){var u=e[i];if(u&&W(u)&&!t(u)){if(r.indexOf(u)>-1)throw new Error("Cannot convert circular structure to JSON");var a=Le(u,t,je(n,[i]),je(r,[u]));o[i]=a;var s=!1;for(var c in a)/^\$/.test(c)?s=!0:(o[i+"."+c]=a[c],delete o[i][c]);s||delete o[i]}}return o}function Me(e){return Le(e,De,[],[e])}function ke(e,t,n){for(var r in t[n]||delete e[n],t)e[r]?Y(e[r])?e[r].push(t[r]):W(e[r])&&W(t[r])?Object.assign(e[r],t[r]):e[r]=t[r]:e[r]=t[r]}function De(e){return X(e)||K(e)||V(e)||Z(e)||ee(e)}function Ce(e){return de(e)}var $e=function(){function e(){}return e.encode=function(e){return(new xe).encodeQuery(e)},e}(),xe=function(){function e(){}return e.prototype.encodeQuery=function(e,t){var n;return De(e)?be(e)?this.encodeLogicCommand(e):Ne(e)?this.encodeQueryCommand(e):((n={})[t]=this.encodeQueryObject(e),n):W(e)?this.encodeQueryObject(e):e},e.prototype.encodeRegExp=function(e){return{$regex:e.source,$options:e.flags}},e.prototype.encodeLogicCommand=function(e){var t,n,r,o,i,u,a,s=this;switch(e.operator){case ye.NOR:case ye.AND:case ye.OR:var c=qe(e.operator),f=e.operands.map((function(t){return s.encodeQuery(t,e.fieldName)}));return(t={})[c]=f,t;case ye.NOT:c=qe(e.operator);var l=e.operands[0];if(V(l))return(n={})[e.fieldName]=((r={})[c]=this.encodeRegExp(l),r),n;f=this.encodeQuery(l)[e.fieldName];return(o={})[e.fieldName]=((i={})[c]=f,i),o;default:c=qe(e.operator);if(1===e.operands.length){var p=this.encodeQuery(e.operands[0]);return(u={})[c]=p,u}f=e.operands.map(this.encodeQuery.bind(this));return(a={})[c]=f,a}},e.prototype.encodeQueryCommand=function(e){return Se(e),this.encodeComparisonCommand(e)},e.prototype.encodeComparisonCommand=function(e){var t,n,r,o,i,u,a,s,c;if(e.fieldName===j)throw new Error("Cannot encode a comparison command with unset field name");var f=qe(e.operator);switch(e.operator){case _e.EQ:case _e.NEQ:case _e.LT:case _e.LTE:case _e.GT:case _e.GTE:case _e.ELEM_MATCH:case _e.EXISTS:case _e.SIZE:case _e.MOD:return(t={})[e.fieldName]=((n={})[f]=Ce(e.operands[0]),n),t;case _e.IN:case _e.NIN:case _e.ALL:return(r={})[e.fieldName]=((o={})[f]=Ce(e.operands),o),r;case _e.GEO_NEAR:var l=e.operands[0];return(i={})[e.fieldName]={$nearSphere:{$geometry:l.geometry.toJSON(),$maxDistance:l.maxDistance,$minDistance:l.minDistance}},i;case _e.GEO_WITHIN:l=e.operands[0];return(u={})[e.fieldName]={$geoWithin:{$geometry:l.geometry.toJSON()}},u;case _e.GEO_INTERSECTS:l=e.operands[0];return(a={})[e.fieldName]={$geoIntersects:{$geometry:l.geometry.toJSON()}},a;default:return(s={})[e.fieldName]=((c={})[f]=Ce(e.operands[0]),c),s}},e.prototype.encodeQueryObject=function(e){var t=Me(e);for(var n in t){var r=t[n];if(be(r)){t[n]=r._setFieldName(n);var o=this.encodeLogicCommand(t[n]);this.mergeConditionAfterEncode(t,o,n)}else if(Se(r)){t[n]=r._setFieldName(n);o=this.encodeComparisonCommand(t[n]);this.mergeConditionAfterEncode(t,o,n)}else De(r)&&(t[n]=Ce(r))}return t},e.prototype.mergeConditionAfterEncode=function(e,t,n){for(var r in t[n]||delete e[n],t)e[r]?Y(e[r])?e[r]=e[r].concat(t[r]):W(e[r])&&W(t[r])?Object.assign(e,t):e[r]=t[r]:e[r]=t[r]},e}(),Fe=function(){function e(){}return e.encode=function(t){return(new e).encodeUpdate(t)},e.prototype.encodeUpdate=function(e){return ge(e)?this.encodeUpdateCommand(e):"object"===B(e)?this.encodeUpdateObject(e):e},e.prototype.encodeUpdateCommand=function(e){if(e.fieldName===j)throw new Error("Cannot encode a comparison command with unset field name");switch(e.operator){case ce.PUSH:case ce.PULL:case ce.PULL_ALL:case ce.POP:case ce.SHIFT:case ce.UNSHIFT:case ce.ADD_TO_SET:return this.encodeArrayUpdateCommand(e);default:return this.encodeFieldUpdateCommand(e)}},e.prototype.encodeFieldUpdateCommand=function(e){var t,n,r,o,i=qe(e.operator);return e.operator===ce.REMOVE?((t={})[i]=((n={})[e.fieldName]="",n),t):((r={})[i]=((o={})[e.fieldName]=e.operands[0],o),r)},e.prototype.encodeArrayUpdateCommand=function(e){var t,n,r,o,i,u,a,s,c,f,l=qe(e.operator);switch(e.operator){case ce.PUSH:var p=void 0;return p=Y(e.operands)?{$each:e.operands.map(Ce)}:e.operands,(t={})[l]=((n={})[e.fieldName]=p,n),t;case ce.UNSHIFT:p={$each:e.operands.map(Ce),$position:0};return(r={})[l]=((o={})[e.fieldName]=p,o),r;case ce.POP:return(i={})[l]=((u={})[e.fieldName]=1,u),i;case ce.SHIFT:return(a={})[l]=((s={})[e.fieldName]=-1,s),a;default:return(c={})[l]=((f={})[e.fieldName]=Ce(e.operands),f),c}},e.prototype.encodeUpdateObject=function(e){var t=Me(e);for(var n in t)if(!/^\$/.test(n)){var r=t[n];if(ge(r)){t[n]=r._setFieldName(n),ke(t,this.encodeUpdateCommand(t[n]),n)}else{t[n]=r=Ce(r);var o=new me(ce.SET,[r],n);ke(t,this.encodeUpdateCommand(o),n)}}return t},e}(),Re=globalThis&&globalThis.__assign||function(){return Re=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Re.apply(this,arguments)},Ge=globalThis&&globalThis.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(t){i(t)}}function a(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))},Ue=globalThis&&globalThis.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Qe=globalThis&&globalThis.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],u=0,a=i.length;u<a;u++,o++)r[o]=i[u];return r},He=function(){function e(e,t,n,r,o,i){this._db=e,this._coll=t,this._fieldFilters=n,this._fieldOrders=r||[],this._queryOptions=o||{},this._withs=i||[],this._request=this._db.request}return e.prototype.where=function(t){if("Object"!==Object.prototype.toString.call(t).slice(8,-1))throw Error(o.QueryParamTypeError);var n=Object.keys(t),r=n.some((function(e){return void 0!==t[e]}));if(n.length&&!r)throw Error(o.QueryParamValueError);var i=$e.encode(t);return new e(this._db,this._coll,i,this._fieldOrders,this._queryOptions,this._withs)},e.prototype.orderBy=function(t,n){te.isFieldPath(t),te.isFieldOrder(n);var r={field:t,direction:n},o=this._fieldOrders.concat(r);return new e(this._db,this._coll,this._fieldFilters,o,this._queryOptions,this._withs)},e.prototype.with=function(t){var n,r,o={query:t.query,foreignField:t.foreignField,localField:t.localField,as:null!==(n=t.as)&&void 0!==n?n:t.query._coll,one:null!==(r=t.one)&&void 0!==r&&r},i=this._withs.concat(o);return new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,this._queryOptions,i)},e.prototype.withOne=function(t){var n,r={query:t.query,foreignField:t.foreignField,localField:t.localField,as:null!==(n=t.as)&&void 0!==n?n:t.query._coll,one:!0},o=this._withs.concat(r);return new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,this._queryOptions,o)},e.prototype.field=function(t){var n={};if(t instanceof Array){for(var r={},o=0,i=t;o<i.length;o++){r[u=i[o]]=1}n=r}else for(var u in t)t[u]?"object"!=typeof t[u]&&(n[u]=1):n[u]=0;var a=Re({},this._queryOptions);return a.projection=n,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,a,this._withs)},e.prototype.limit=function(t){te.isInteger("limit",t);var n=Re({},this._queryOptions);return n.limit=t,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,n,this._withs)},e.prototype.skip=function(t){te.isInteger("offset",t);var n=Re({},this._queryOptions);return n.offset=t,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,n,this._withs)},e.prototype.page=function(e){var t=(null==e?void 0:e.current)||1,n=(null==e?void 0:e.size)||10,r=this.skip((t-1)*n).limit(n);return r._queryOptions.count=!0,r},e.prototype.clone=function(){return new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,this._queryOptions,this._withs)},e.prototype.get=function(){var e;return Ge(this,void 0,void 0,(function(){return Ue(this,(function(t){switch(t.label){case 0:return(null===(e=this._withs)||void 0===e?void 0:e.length)?[4,this.internalMerge()]:[3,2];case 1:case 3:return[2,t.sent()];case 2:return[4,this.internalGet()]}}))}))},e.prototype.getOne=function(){return Ge(this,void 0,void 0,(function(){var e;return Ue(this,(function(t){switch(t.label){case 0:return[4,this.limit(1).get()];case 1:return(e=t.sent()).error?[2,e]:e.data.length?[2,{ok:!0,data:e.data[0],requestId:e.requestId}]:[2,{ok:!0,data:null,requestId:e.requestId}]}}))}))},e.prototype.merge=function(e){return Ge(this,void 0,void 0,(function(){return Ue(this,(function(t){switch(t.label){case 0:return[4,this.internalMerge(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.count=function(){return Ge(this,void 0,void 0,(function(){var e,t;return Ue(this,(function(n){switch(n.label){case 0:return e=this.buildQueryParam(),[4,this.send(s.count,e)];case 1:return(t=n.sent()).error?[2,{requestId:t.requestId,ok:!1,error:t.error,total:void 0,code:t.code}]:[2,{requestId:t.requestId,total:t.data.total,ok:!0}]}}))}))},e.prototype.update=function(e,t){var n,r,o,i;return Ge(this,void 0,void 0,(function(){var u,a;return Ue(this,(function(c){switch(c.label){case 0:if(!e||"object"!=typeof e||0===(null===(n=Object.keys(e))||void 0===n?void 0:n.length))throw new Error("data cannot be empty object");if(e.hasOwnProperty("_id"))throw new Error("can not update the `_id` field");return(u=this.buildQueryParam()).multi=null!==(r=null==t?void 0:t.multi)&&void 0!==r&&r,u.merge=null===(o=null==t?void 0:t.merge)||void 0===o||o,u.upsert=null!==(i=null==t?void 0:t.upsert)&&void 0!==i&&i,u.merge?u.data=Fe.encode(e):u.data=de(e),[4,this.send(s.update,u)];case 1:return(a=c.sent()).error?[2,{requestId:a.requestId,error:a.error,ok:!1,code:a.code,updated:void 0,matched:void 0,upsertId:void 0}]:[2,{requestId:a.requestId,updated:a.data.updated,matched:a.data.matched,upsertId:a.data.upsert_id,ok:!0}]}}))}))},e.prototype.remove=function(e){var t,n;return Ge(this,void 0,void 0,(function(){var r,o;return Ue(this,(function(i){switch(i.label){case 0:return Object.keys(this._queryOptions).length,null===(t=this._fieldOrders)||void 0===t||t.length,(r=this.buildQueryParam()).multi=null!==(n=null==e?void 0:e.multi)&&void 0!==n&&n,[4,this.send(s.remove,r)];case 1:return(o=i.sent()).error?[2,{requestId:o.requestId,error:o.error,ok:!1,deleted:void 0,code:o.code}]:[2,{requestId:o.requestId,deleted:o.data.deleted,ok:!0}]}}))}))},e.prototype.buildQueryParam=function(){var e,t={collectionName:this._coll};return this._fieldFilters&&(t.query=this._fieldFilters),(null===(e=this._fieldOrders)||void 0===e?void 0:e.length)&&(t.order=Qe(this._fieldOrders)),this._queryOptions.offset&&(t.offset=this._queryOptions.offset),this._queryOptions.limit?t.limit=this._queryOptions.limit<1e3?this._queryOptions.limit:1e3:t.limit=100,this._queryOptions.projection&&(t.projection=this._queryOptions.projection),this._queryOptions.count&&(t.count=this._queryOptions.count),t},e.prototype.internalGet=function(){var e,t,n;return Ge(this,void 0,void 0,(function(){var r,o,i,u;return Ue(this,(function(a){switch(a.label){case 0:return r=this.buildQueryParam(),[4,this.send(s.query,r)];case 1:return(o=a.sent()).error?[2,{error:o.error,data:o.data,requestId:o.requestId,ok:!1,code:o.code}]:(i=J.formatResDocumentData(o.data.list),u={data:i,requestId:o.requestId,ok:!0},o.total&&(u.total=null===(e=o.data)||void 0===e?void 0:e.total),o.limit&&(u.limit=null===(t=o.data)||void 0===t?void 0:t.limit),o.offset&&(u.offset=null===(n=o.data)||void 0===n?void 0:n.offset),[2,u])}}))}))},e.prototype.internalMerge=function(e){var t;return Ge(this,void 0,void 0,(function(){var n,r,o,i,u,a,s;return Ue(this,(function(c){switch(c.label){case 0:return n=null!==(t=null==(e=null!=e?e:{})?void 0:e.intersection)&&void 0!==t&&t,[4,this.internalGet()];case 1:if(!(r=c.sent()).ok)return[2,r];o=function(e){var t,o,i,u,a,s,c,f,l,p,d,h,y,w,m,g,v;return Ue(this,(function(b){switch(b.label){case 0:return t=e.query,o=e.localField,i=e.foreignField,u=e.as,a=e.one,s=r.data.map((function(e){return e[o]})),(c=t.clone())._fieldFilters||(c._fieldFilters={}),c._fieldFilters[i]={$in:s},f=void 0,c._withs.length?[4,c.merge()]:[3,2];case 1:return f=b.sent(),[3,4];case 2:return[4,c.get()];case 3:f=b.sent(),b.label=4;case 4:if(!f.ok)return[2,{value:f}];for(l={},p=0,d=f.data;p<d.length;p++)h=d[p],v=h[i],a?l[v]=h:(l[v]=l[v]||[],l[v].push(h));for(y=[],w=0,m=r.data;w<m.length;w++)g=m[w],v=g[o],g[u]=l[v],n&&!l[v]||y.push(g);return r.data=y,[2]}}))},i=0,u=this._withs,c.label=2;case 2:return i<u.length?(a=u[i],[5,o(a)]):[3,5];case 3:if("object"==typeof(s=c.sent()))return[2,s.value];c.label=4;case 4:return i++,[3,2];case 5:return[2,r]}}))}))},e.prototype.send=function(e,t){return Ge(this,void 0,void 0,(function(){return Ue(this,(function(n){switch(n.label){case 0:return[4,this._request.send(e,t)];case 1:return[2,n.sent()]}}))}))},e}(),Je=globalThis&&globalThis.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(t){i(t)}}function a(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))},Be=globalThis&&globalThis.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},We=function(){function e(e,t,n,r){this._db=e,this._coll=t,this.id=n,this._query=r||new He(e,t)}return e.prototype.create=function(e,t){var n,r;return Je(this,void 0,void 0,(function(){var o,i;return Be(this,(function(u){switch(u.label){case 0:if(!e||"object"!=typeof e||0===(null===(n=Object.keys(e))||void 0===n?void 0:n.length))throw new Error("data cannot be empty object");return o={collectionName:this._coll,data:de(e),multi:null!==(r=null==t?void 0:t.multi)&&void 0!==r&&r},[4,this._query.send(s.add,o)];case 1:return(i=u.sent()).error?[2,{requestId:i.requestId,error:i.error,ok:!1,id:void 0,insertedCount:void 0,code:i.code}]:[2,{id:i.data._id||i.data[this._db.primaryKey],insertedCount:i.data.insertedCount,requestId:i.requestId,ok:!0}]}}))}))},e.prototype.set=function(e){return Je(this,void 0,void 0,(function(){var t,n,r;return Be(this,(function(o){switch(o.label){case 0:if(!this.id)throw new Error("document id cannot be empty");if(t=!1,n=function(e){if("object"==typeof e)for(var r in e)e[r]instanceof me?t=!0:"object"==typeof e[r]&&n(e[r])},n(e),t)throw new Error("data cannot contain operator");return!1,[4,this._query.where((r={},r[this._db.primaryKey]=this.id,r)).update(de(e),{merge:false,multi:!1,upsert:!0})];case 1:return[2,o.sent()]}}))}))},e.prototype.update=function(e){return Je(this,void 0,void 0,(function(){var t,n;return Be(this,(function(r){switch(r.label){case 0:return!0,t={merge:true,multi:!1,upsert:!1},[4,this._query.where((n={},n[this._db.primaryKey]=this.id,n)).update(e,t)];case 1:return[2,r.sent()]}}))}))},e.prototype.remove=function(){return Je(this,void 0,void 0,(function(){var e;return Be(this,(function(t){switch(t.label){case 0:return[4,this._query.where((e={},e[this._db.primaryKey]=this.id,e)).remove({multi:!1})];case 1:return[2,t.sent()]}}))}))},e.prototype.get=function(){return Je(this,void 0,void 0,(function(){var e;return Be(this,(function(t){switch(t.label){case 0:return[4,this._query.where((e={},e[this._db.primaryKey]=this.id,e)).getOne()];case 1:return[2,t.sent()]}}))}))},e.prototype.field=function(t){return new e(this._db,this._coll,this.id,this._query.field(t))},e}(),ze=function(e){if(!W(e))return e;for(var t in e)void 0===e[t]?delete e[t]:W(e[t])&&(e[t]=ze(e[t]));return e},Ye=globalThis&&globalThis.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(t){i(t)}}function a(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))},Ke=globalThis&&globalThis.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ve=6378100,Xe=function(){function t(e,t,n){var r=this;this._stages=[],e&&t&&(this._db=e,this._request=this._db.request,this._collectionName=t,n&&n.length>0&&n.forEach((function(e){te.isValidAggregation(e);var t=Object.keys(e)[0];r._pipe(t,e[t],!0)})))}return t.prototype.end=function(){var e;return Ye(this,void 0,void 0,(function(){var t,n;return Ke(this,(function(r){switch(r.label){case 0:if(!this._collectionName||!this._db)throw new Error("Aggregation pipeline cannot send request");if(!(null===(e=this._stages)||void 0===e?void 0:e.length))throw new Error("Aggregation stage cannot be empty");return[4,this._request.send(s.aggregate,{collectionName:this._collectionName,stages:this._stages})];case 1:return(t=r.sent()).error?[2,{error:t.error,data:t.data,requestId:t.requestId,ok:!1,code:t.code}]:(n=J.formatResDocumentData(t.data.list),[2,{data:n,requestId:t.requestId,ok:!0}])}}))}))},t.prototype.unwrap=function(){return this._stages},t.prototype.done=function(){return this._stages.map((function(e){var t,n=e.stageKey,r=e.stageValue;return(t={})[n]=JSON.parse(r),t}))},t.prototype._pipe=function(t,n,r){void 0===r&&(r=!1);var o,i="";return"object"===B(n)?(o=ze(o=n),i=e.stringify(o,{relaxed:!1})):i=JSON.stringify(n),this._stages.push({stageKey:r?t:"$"+t,stageValue:i}),this},t.prototype.addFields=function(e){return this._pipe("addFields",e)},t.prototype.bucket=function(e){return this._pipe("bucket",e)},t.prototype.bucketAuto=function(e){return this._pipe("bucketAuto",e)},t.prototype.count=function(e){return this._pipe("count",e)},t.prototype.geoNear=function(e){return e.query&&(e.query=$e.encode(e.query)),e.distanceMultiplier&&"number"==typeof e.distanceMultiplier?e.distanceMultiplier=e.distanceMultiplier*Ve:e.distanceMultiplier=Ve,this._pipe("geoNear",e)},t.prototype.group=function(e){return this._pipe("group",e)},t.prototype.limit=function(e){return this._pipe("limit",e)},t.prototype.match=function(e){return this._pipe("match",$e.encode(e))},t.prototype.project=function(e){return this._pipe("project",e)},t.prototype.lookup=function(e){return this._pipe("lookup",e)},t.prototype.replaceRoot=function(e){return this._pipe("replaceRoot",e)},t.prototype.sample=function(e){return this._pipe("sample",e)},t.prototype.skip=function(e){return this._pipe("skip",e)},t.prototype.sort=function(e){return this._pipe("sort",e)},t.prototype.sortByCount=function(e){return this._pipe("sortByCount",e)},t.prototype.unwind=function(e){return this._pipe("unwind",e)},t}(),Ze=globalThis&&globalThis.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),et=function(e){function t(t,n){return e.call(this,t,n)||this}return Ze(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),t.prototype.doc=function(e){if(!e)throw new Error("docID cannot be empty");return new We(this._db,this._coll,e)},t.prototype.add=function(e,t){return new We(this._db,this._coll,void 0).create(e,t)},t.prototype.aggregate=function(e){return void 0===e&&(e=[]),new Xe(this._db,this._coll,e)},t}(He),tt={eq:function(e){return new Te(_e.EQ,[e])},neq:function(e){return new Te(_e.NEQ,[e])},lt:function(e){return new Te(_e.LT,[e])},lte:function(e){return new Te(_e.LTE,[e])},gt:function(e){return new Te(_e.GT,[e])},gte:function(e){return new Te(_e.GTE,[e])},in:function(e){return new Te(_e.IN,e)},nin:function(e){return new Te(_e.NIN,e)},all:function(e){return new Te(_e.ALL,e)},elemMatch:function(e){return new Te(_e.ELEM_MATCH,[e])},exists:function(e){return new Te(_e.EXISTS,[e])},size:function(e){return new Te(_e.SIZE,[e])},mod:function(e){return new Te(_e.MOD,[e])},geoNear:function(e){return new Te(_e.GEO_NEAR,[e])},geoWithin:function(e){return new Te(_e.GEO_WITHIN,[e])},geoIntersects:function(e){return new Te(_e.GEO_INTERSECTS,[e])},like:function(e){return new Te(_e.LIKE,[e])},and:function(){var e=Y(arguments[0])?arguments[0]:Array.from(arguments);return new ve(ye.AND,e)},nor:function(){var e=Y(arguments[0])?arguments[0]:Array.from(arguments);return new ve(ye.NOR,e)},or:function(){var e=Y(arguments[0])?arguments[0]:Array.from(arguments);return new ve(ye.OR,e)},not:function(){var e=Y(arguments[0])?arguments[0]:Array.from(arguments);return new ve(ye.NOT,e)},set:function(e){return new me(ce.SET,[e])},remove:function(){return new me(ce.REMOVE,[])},inc:function(e){return new me(ce.INC,[e])},mul:function(e){return new me(ce.MUL,[e])},push:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(W(t[0])&&t[0].hasOwnProperty("each")){var r=t[0];e={$each:r.each,$position:r.position,$sort:r.sort,$slice:r.slice}}else e=Y(t[0])?t[0]:Array.from(t);return new me(ce.PUSH,e)},pull:function(e){return new me(ce.PULL,e)},pullAll:function(e){return new me(ce.PULL_ALL,e)},pop:function(){return new me(ce.POP,[])},shift:function(){return new me(ce.SHIFT,[])},unshift:function(){var e=Y(arguments[0])?arguments[0]:Array.from(arguments);return new me(ce.UNSHIFT,e)},addToSet:function(e){return new me(ce.ADD_TO_SET,e)},rename:function(e){return new me(ce.RENAME,[e])},bit:function(e){return new me(ce.BIT,[e])},max:function(e){return new me(ce.MAX,[e])},min:function(e){return new me(ce.MIN,[e])},expr:function(e){return{$expr:e}},jsonSchema:function(e){return{$jsonSchema:e}},text:function(e){return"string"===B(e)?{$search:e.search}:{$search:e.search,$language:e.language,$caseSensitive:e.caseSensitive,$diacriticSensitive:e.diacriticSensitive}},aggregate:{pipeline:function(){return new Xe},abs:function(e){return new nt("abs",e)},add:function(e){return new nt("add",e)},ceil:function(e){return new nt("ceil",e)},divide:function(e){return new nt("divide",e)},exp:function(e){return new nt("exp",e)},floor:function(e){return new nt("floor",e)},ln:function(e){return new nt("ln",e)},log:function(e){return new nt("log",e)},log10:function(e){return new nt("log10",e)},mod:function(e){return new nt("mod",e)},multiply:function(e){return new nt("multiply",e)},pow:function(e){return new nt("pow",e)},sqrt:function(e){return new nt("sqrt",e)},subtract:function(e){return new nt("subtract",e)},trunc:function(e){return new nt("trunc",e)},arrayElemAt:function(e){return new nt("arrayElemAt",e)},arrayToObject:function(e){return new nt("arrayToObject",e)},concatArrays:function(e){return new nt("concatArrays",e)},filter:function(e){return new nt("filter",e)},in:function(e){return new nt("in",e)},indexOfArray:function(e){return new nt("indexOfArray",e)},isArray:function(e){return new nt("isArray",e)},map:function(e){return new nt("map",e)},range:function(e){return new nt("range",e)},reduce:function(e){return new nt("reduce",e)},reverseArray:function(e){return new nt("reverseArray",e)},size:function(e){return new nt("size",e)},slice:function(e){return new nt("slice",e)},zip:function(e){return new nt("zip",e)},and:function(e){return new nt("and",e)},not:function(e){return new nt("not",e)},or:function(e){return new nt("or",e)},cmp:function(e){return new nt("cmp",e)},eq:function(e){return new nt("eq",e)},gt:function(e){return new nt("gt",e)},gte:function(e){return new nt("gte",e)},lt:function(e){return new nt("lt",e)},lte:function(e){return new nt("lte",e)},neq:function(e){return new nt("ne",e)},cond:function(e){return new nt("cond",e)},ifNull:function(e){return new nt("ifNull",e)},switch:function(e){return new nt("switch",e)},dateFromParts:function(e){return new nt("dateFromParts",e)},dateFromString:function(e){return new nt("dateFromString",e)},dayOfMonth:function(e){return new nt("dayOfMonth",e)},dayOfWeek:function(e){return new nt("dayOfWeek",e)},dayOfYear:function(e){return new nt("dayOfYear",e)},isoDayOfWeek:function(e){return new nt("isoDayOfWeek",e)},isoWeek:function(e){return new nt("isoWeek",e)},isoWeekYear:function(e){return new nt("isoWeekYear",e)},millisecond:function(e){return new nt("millisecond",e)},minute:function(e){return new nt("minute",e)},month:function(e){return new nt("month",e)},second:function(e){return new nt("second",e)},hour:function(e){return new nt("hour",e)},week:function(e){return new nt("week",e)},year:function(e){return new nt("year",e)},literal:function(e){return new nt("literal",e)},mergeObjects:function(e){return new nt("mergeObjects",e)},objectToArray:function(e){return new nt("objectToArray",e)},allElementsTrue:function(e){return new nt("allElementsTrue",e)},anyElementTrue:function(e){return new nt("anyElementTrue",e)},setDifference:function(e){return new nt("setDifference",e)},setEquals:function(e){return new nt("setEquals",e)},setIntersection:function(e){return new nt("setIntersection",e)},setIsSubset:function(e){return new nt("setIsSubset",e)},setUnion:function(e){return new nt("setUnion",e)},concat:function(e){return new nt("concat",e)},dateToString:function(e){return new nt("dateToString",e)},indexOfBytes:function(e){return new nt("indexOfBytes",e)},indexOfCP:function(e){return new nt("indexOfCP",e)},split:function(e){return new nt("split",e)},strLenBytes:function(e){return new nt("strLenBytes",e)},strLenCP:function(e){return new nt("strLenCP",e)},strcasecmp:function(e){return new nt("strcasecmp",e)},substr:function(e){return new nt("substr",e)},substrBytes:function(e){return new nt("substrBytes",e)},substrCP:function(e){return new nt("substrCP",e)},toLower:function(e){return new nt("toLower",e)},toUpper:function(e){return new nt("toUpper",e)},meta:function(e){return new nt("meta",e)},addToSet:function(e){return new nt("addToSet",e)},avg:function(e){return new nt("avg",e)},first:function(e){return new nt("first",e)},last:function(e){return new nt("last",e)},max:function(e){return new nt("max",e)},min:function(e){return new nt("min",e)},push:function(e){return new nt("push",e)},stdDevPop:function(e){return new nt("stdDevPop",e)},stdDevSamp:function(e){return new nt("stdDevSamp",e)},sum:function(e){return new nt("sum",e)},let:function(e){return new nt("let",e)}},project:{slice:function(e){return new rt("slice",e)},elemMatch:function(e){return new rt("elemMatch",e)}}},nt=function(e,t){this["$"+e]=t},rt=function(e,t){this["$"+e]=t},ot=function(){function e(e){var t=e.regexp,n=e.options;if(!t)throw new TypeError("regexp must be a string");this.$regex=t,this.$options=n||""}return e.prototype.parse=function(){return{$regex:this.$regex,$options:this.$options}},Object.defineProperty(e.prototype,"_internalType",{get:function(){return U},enumerable:!0,configurable:!0}),e}();function it(e){return new ot(e)}var ut=function(){function e(e){var t;if(this.Geo=se,this.command=tt,this.RegExp=it,this.serverDate=H,!e.request)throw new Error("DbConfig.request cannot be empty");this.request=e.request,this.primaryKey=null!==(t=e.primaryKey)&&void 0!==t?t:"_id"}return e.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new et(this,e)},e.prototype.generateId=function(){return(new t).toHexString()},e.prototype.ObjectId=function(e){return new t(e)},e}();export{ut as D};
